---
name: video-extension
status: completed
completed: 2025-12-05
updated: 2025-12-05
depends:
  - text-to-video
---

# Overview

Extend previously generated videos with new footage using the `--extend` parameter, enabling scene continuation.

# Specification

## Command Interface

```
nano-banana --video "<continuation prompt>" --extend <video.mp4> [options]
```

## Behavior

1. Validate video file exists at `--extend` path
2. Look for corresponding `.uri` file (same path with `.uri` extension)
3. Read the Google Cloud Storage URI from `.uri` file
4. Build video request with `video.gcsUri` field:
   ```json
   {
     "video": {
       "gcsUri": "<uri-from-file>"
     }
   }
   ```
5. Force resolution to 720p (API requirement)
6. Generate video that continues from the end of the original
7. Save new video (can be extended again, up to 20 times)

## Parameters

All text-to-video parameters apply, with these constraints:

| Parameter | Constraint | Reason |
|-----------|-----------|--------|
| `--resolution` | Forced to 720p | API limitation for extensions |
| `--file` | Cannot be used | Mutually exclusive with `--extend` |
| `--reference` | Cannot be used | Not supported with extensions |

## URI File Requirement

The `.uri` file:
- Created automatically when a video is generated
- Contains the Google Cloud Storage URI of the video
- Must exist alongside the video file
- Format: Plain text, single line

Example:
- Video: `output/video-123.mp4`
- URI: `output/video-123.uri`

## Extension Limits

- Maximum 20 extensions per original video
- Each extension adds another segment
- Total video length limited by API

## Error Handling

| Condition | Behavior |
|-----------|----------|
| Video file not found | Exit 1 with "Video file not found" |
| URI file not found | Exit 1 with "Can only extend videos generated by nano-banana" |
| Combined with `--file` | Exit 1 with "Cannot use --file with --extend" |
| Combined with `--reference` | Exit 1 with "Cannot use --reference with --extend" |
| Resolution not 720p | Log note, force to 720p |

# Knowledge Required

- [skills/nano-banana-videogen/examples/scene-extensions.md](../skills/nano-banana-videogen/examples/scene-extensions.md) - Extension patterns

# Context Requirements

- [x] `GEMINI_API_KEY` environment variable set
- [x] Original video was generated by nano-banana (has .uri file)
- [x] Sufficient API credits for video generation

### Success Metrics

- **Functional Correctness**: Video is extended
  - New footage continues from original
  - URI file created for new video
  - Can chain multiple extensions
- **Spec Adherence**:
  - Resolution forced to 720p with log message
  - Mutual exclusions enforced
- **Quality Gates**:
  - Original video not modified
  - Seamless transition between segments

### Validation Commands

```bash
# First generate a base video
nano-banana --video "A person walking forward" --video-fast --no-audio --output /tmp/base.mp4

# Verify URI file created
test -f /tmp/base.uri && echo "PASS: URI file exists"

# Extend the video
nano-banana --video "They stop and turn around" --extend /tmp/base.mp4 --output /tmp/extended.mp4

# Verify extension created its own URI
test -f /tmp/extended.uri && echo "PASS: Extension has URI file"

# Verify resolution constraint
nano-banana --video "Continue" --extend /tmp/base.mp4 --resolution 1080p 2>&1 | grep -q "720p" && echo "PASS: Resolution forced"

# Verify cannot combine with --reference
nano-banana --video "test" --extend /tmp/base.mp4 --reference /tmp/ref.png 2>&1 | grep -q "Cannot use" && echo "PASS: Reference blocked"

# Error case: non-nano-banana video
touch /tmp/external.mp4
nano-banana --video "extend" --extend /tmp/external.mp4 2>&1 | grep -q "URI file not found" && echo "PASS: External video rejected"
```
